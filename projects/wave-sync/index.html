<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>WaveSync — Udit C.</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#050505;
    --ink:#f5f5f7;
    --muted:#c7c7d0;
    --brand:#ff22d0; /* neon magenta accent */
    --panel:#0d0d10;
    --line:#1e1e24;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--ink); background:var(--bg);
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  a{color:#caa8ff}
  .wrap{max-width:980px; margin:0 auto; padding:24px 16px}
  header{padding:18px 0 4px}
  h1{
    font-family:Poppins, Inter, sans-serif;
    font-weight:800; font-size:48px; margin:10px 0 6px; text-align:center;
    color:var(--brand); letter-spacing:.5px;
  }
  .sub{font-size:20px; text-align:center; color:#e9e9f4; margin:0 0 18px}
  .controls{
    display:grid; gap:18px; margin:10px auto 12px; max-width:860px;
  }
  .row{display:grid; grid-template-columns: 1fr auto; gap:18px; align-items:center}
  .label{
    font-family:Poppins, Inter, sans-serif; font-weight:700; font-size:28px;
  }
  .value{min-width:36px; text-align:right; font-weight:700}
  input[type="range"]{
    width:100%; height:14px; border-radius:999px; background:#201a21; outline:none;
    -webkit-appearance:none; appearance:none;
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:26px; height:26px; border-radius:50%;
    background:var(--brand); border:2px solid #000; cursor:pointer;
    box-shadow:0 0 0 2px rgba(255,255,255,.15) inset;
  }
  .toggle{
    display:flex; align-items:center; gap:14px; justify-content:center; margin-top:6px;
    font-family:Poppins, Inter, sans-serif; font-size:28px; font-weight:700;
  }
  .toggle input{width:28px; height:28px; accent-color:var(--brand)}
  .what{text-align:center; margin:6px 0 8px}
  .stage{
    margin-top:14px; height:480px; border-radius:12px; overflow:hidden;
    background:#000; border:1px solid #1d1d22; position:relative;
  }
  canvas{display:block; width:100%; height:100%}
  .back{display:inline-block; margin:4px 0 8px; text-decoration:none;
        border:1px solid #2b2b33; border-radius:10px; padding:7px 10px; color:#e6e6f4}
  @media (max-width:700px){
    h1{font-size:42px}
    .label{font-size:24px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <a class="back" href="../../">← Back to Portfolio</a>
    <header>
      <h1>WaveSync</h1>
      <p class="sub">A small audiovisual encounter with synchronized waves and the butterfly effect</p>
    </header>

    <!-- Controls -->
    <div class="controls">
      <div class="row">
        <div class="label">Number of Pendulums:</div>
        <div>
          <input id="count" type="range" min="1" max="20" value="5" />
          <div class="value"><span id="countVal">5</span></div>
        </div>
      </div>

      <div class="row">
        <div class="label">Slow motion (1–100x):</div>
        <div>
          <input id="slow" type="range" min="1" max="100" value="1" />
          <div class="value"><span id="slowVal">1</span>x</div>
        </div>
      </div>
    </div>

    <div class="toggle">
      <span>Show Trails:</span><input id="trails" type="checkbox">
    </div>
    <div class="toggle">
      <span>Enable Audio:</span><input id="audio" type="checkbox">
    </div>

    <p class="what"><a href="#about">What is WaveSync?</a></p>

    <!-- Canvas -->
    <div class="stage"><canvas id="cv"></canvas></div>

    <section id="about" style="margin:18px 0 8px; color:var(--muted); line-height:1.65">
      <p><strong>WaveSync</strong> renders a set of pendulums with slightly different lengths and damping. Tiny differences de-phase over time, producing intricate wave patterns. Use the sliders to change the count and time scale. Trails fade with transparency. Audio (optional) maps kinetic energy to simple tones.</p>
    </section>
  </div>

<script>
(() => {
  // ---- Canvas setup
  const canvas = document.getElementById('cv');
  const ctx = canvas.getContext('2d');
  const DPR = Math.max(1, window.devicePixelRatio || 1);

  function resize(){
    const r = canvas.getBoundingClientRect();
    canvas.width  = Math.floor(r.width * DPR);
    canvas.height = Math.floor(r.height * DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0); // draw in CSS pixels
  }
  addEventListener('resize', resize, {passive:true});
  resize();

  // ---- Controls
  const $ = sel => document.querySelector(sel);
  const count = $('#count'), slow = $('#slow'),
        trails = $('#trails'), audio = $('#audio');
  const countVal = $('#countVal'), slowVal = $('#slowVal');

  count.addEventListener('input', () => countVal.textContent = count.value);
  slow.addEventListener('input',  () => slowVal.textContent  = slow.value);

  // ---- Audio (optional)
  let audioCtx = null, masterGain = null;
  function enableAudio(on){
    if(on && !audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.06; // very soft
      masterGain.connect(audioCtx.destination);
    }else if(!on && audioCtx){
      masterGain.disconnect();
      audioCtx.close(); audioCtx = null; masterGain = null;
    }
  }
  audio.addEventListener('change', e => enableAudio(e.target.checked));

  // ---- Pendulum model
  class Pendulum {
    constructor(originX, originY, length, theta, hue){
      this.ox = originX; this.oy = originY;
      this.L = length;               // length (px)
      this.theta = theta;            // angle (rad)
      this.omega = 0;                // angular velocity
      this.alpha = 0;                // angular acceleration
      this.damping = 0.002 + Math.random()*0.002; // small air resistance
      this.g = 0.8 + Math.random()*0.2;          // gravity factor (tuned)
      this.hue = hue;
      // audio
      this.osc = null; this.gain = null;
    }
    attachAudio(){
      if(!audioCtx || this.osc) return;
      this.osc = audioCtx.createOscillator();
      this.gain = audioCtx.createGain();
      this.osc.type = 'sine';
      this.osc.frequency.value = 200; // base
      this.gain.gain.value = 0.0;
      this.osc.connect(this.gain).connect(masterGain);
      this.osc.start();
    }
    detachAudio(){
      if(this.osc){
        try{ this.osc.stop(); }catch(e){}
        this.osc.disconnect(); this.gain.disconnect();
        this.osc = null; this.gain = null;
      }
    }
    step(dt){
      // equation: d2θ/dt2 = -(g/L) sin θ - c dθ/dt
      const c = this.damping;
      this.alpha = -(this.g/this.L) * Math.sin(this.theta) - c*this.omega;
      this.omega += this.alpha * dt;
      this.theta += this.omega * dt;
      // audio mapping
      if(this.osc && this.gain){
        const speed = Math.abs(this.omega);
        this.osc.frequency.value = 160 + speed*180;
        this.gain.gain.value = Math.min(0.12, speed*0.06);
      }
    }
    draw(ctx){
      const x = this.ox + Math.sin(this.theta) * this.L;
      const y = this.oy + Math.cos(this.theta) * this.L;
      ctx.lineWidth = 3;
      ctx.strokeStyle = `hsl(${this.hue}, 90%, 60%)`;
      ctx.beginPath(); ctx.moveTo(this.ox, this.oy); ctx.lineTo(x, y); ctx.stroke();
      ctx.fillStyle = `hsl(${this.hue}, 100%, 60%)`;
      ctx.beginPath(); ctx.arc(x, y, 7, 0, Math.PI*2); ctx.fill();
      return {x,y};
    }
  }

  // ---- Build system
  let pendulums = [];
  function build(){
    pendulums.forEach(p => p.detachAudio());
    pendulums = [];
    const N = parseInt(count.value, 10);
    const rect = canvas.getBoundingClientRect();
    const ox = rect.width * 0.65, oy = rect.height * 0.15; // top-right-ish
    const baseL = Math.min(rect.width, rect.height) * 0.45;
    for(let i=0;i<N;i++){
      const L = baseL * (0.65 + i/(N*2));      // tiny length changes
      const theta = (Math.PI/2.2) * (0.7 + i/(N*6)); // slightly different starts
      const hue = 300 + i * (360/N); // vibrant spread around magenta
      const p = new Pendulum(ox, oy, L, theta, hue);
      if(audio.checked) p.attachAudio();
      pendulums.push(p);
    }
  }
  build();
  count.addEventListener('input', build);
  audio.addEventListener('change', () => {
    if(audio.checked) pendulums.forEach(p => p.attachAudio());
    else pendulums.forEach(p => p.detachAudio());
  });

  // ---- Animation
  let last = performance.now();
  function frame(now){
    const scale = parseFloat(slow.value);     // 1..100 (higher = slower)
    const dt = Math.min(0.032, (now-last)/1000) / scale; // cap dt for stability
    last = now;

    // trails: translucent fill to fade; otherwise clear hard
    if(trails.checked){
      ctx.fillStyle = 'rgba(0,0,0,0.08)';
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }else{
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    // draw origin as subtle node
    const rect = canvas.getBoundingClientRect();
    const ox = rect.width * 0.65, oy = rect.height * 0.15;
    ctx.fillStyle = '#222';
    ctx.beginPath(); ctx.arc(ox, oy, 4, 0, Math.PI*2); ctx.fill();

    // step & draw all
    pendulums.forEach(p => { p.step(dt*60); p.draw(ctx); }); // *60 to feel lively
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
})();
</script>
</body>
</html>
